{% extends 'common/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ page_title }}</h1>
    <span class="badge bg-secondary">{{ books|length }} Books Total</span>
    <form method="get" class="mb-4">
    <div class="input-group shadow-sm">
        <span class="input-group-text bg-white border-end-0">
            <i class="bi bi-search text-muted"></i>
        </span>

        {% if search_form.query %}
            {{ search_form.query }}
        {% else %}
            {{ search_form }}
        {% endif %}

        <button class="btn btn-primary px-4" type="submit">
            Search
        </button>

        {% if request.GET.query %}
            <a href="{% url 'books:books_list' %}" class="btn btn-outline-secondary">
                Clear
            </a>
        {% endif %}
    </div>
    </form>
</div>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Avg. Rating</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                    <td>
                        {% if book.image_url %}
                            <img src="{{ book.image_url }}"
                                 alt="{{ book.title }}"
                                 class="rounded shadow-sm"
                                 style="max-width: 200px; height: auto; display: block;">
                        {% else %}
                            <div class="bg-light text-muted d-flex align-items-center justify-content-center rounded"
                                 style="width: 80px; height: 110px; font-size: 0.8rem; border: 1px dashed #dee2e6;">
                                No Cover
                            </div>
                        {% endif %}
                    </td>
                <tr>
                    <td class="fw-bold">{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>
                        {% if book.avg_rating %}
                            <span class="text-warning">â˜…</span> {{ book.avg_rating|floatformat:2 }}
                        {% else %}
                            <span class="text-muted">No ratings</span>
                        {% endif %}
                    </td>
                    <td class="text-end">
                        <a href="{% url 'books:book_details' book.slug %}" class="btn btn-sm btn-outline-primary">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-4 text-muted">No books found in the library.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}